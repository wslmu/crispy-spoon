<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>Wissal Knowledge Exam</title>

  <!-- Modern fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --page:#fbf8ff;

      --panel-1:#fff7fb;
      --panel-2:#f6f2ff;

      --card:#ffffffd8;
      --card-strong:#ffffffef;

      --ink:#241b2a;
      --muted:#6a5a73;

      --lav:#cbb7ff;
      --pink:#ffb6d9;
      --blue:#bfe6ff;

      --line:#eadff2;
      --shadow: 0 18px 50px rgba(34, 16, 45, .10);
      --shadow-soft: 0 12px 28px rgba(34, 16, 45, .08);

      --radius: 26px;
      --radius-sm: 18px;
      --ease: cubic-bezier(.2,.9,.2,1);

      --good:#3bb273;
      --bad:#e0586a;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body{
      margin:0;
      color:var(--ink);
      font-family: "Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(160deg, #fbf6ff, #fff8fb);
      overflow-x:hidden;
    }

    /* CENTERED APP PANEL (keeps gradient in one block) */
    .wrap{
      min-height: 100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px 14px;
    }

    .panel{
      width: min(980px, 100%);
      border-radius: 30px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(234,223,242,.95);
      box-shadow: 0 22px 70px rgba(34, 16, 45, .14);
      background:
        radial-gradient(900px 600px at 18% 12%, rgba(255,182,217,.35), transparent 60%),
        radial-gradient(900px 600px at 85% 10%, rgba(203,183,255,.40), transparent 55%),
        radial-gradient(900px 600px at 70% 85%, rgba(191,230,255,.40), transparent 60%),
        linear-gradient(160deg, var(--panel-1), var(--panel-2));
      padding: 18px 16px 18px;
    }

    /* subtle sparkle texture inside panel */
    .panel::before{
      content:"";
      position:absolute;
      inset:-40px;
      pointer-events:none;
      opacity:.38;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,.50) 0 1px, transparent 2px),
        radial-gradient(circle at 80% 15%, rgba(255,255,255,.50) 0 1px, transparent 2px),
        radial-gradient(circle at 25% 70%, rgba(255,255,255,.42) 0 1px, transparent 2px),
        radial-gradient(circle at 60% 60%, rgba(255,255,255,.42) 0 1px, transparent 2px),
        radial-gradient(circle at 40% 35%, rgba(255,255,255,.50) 0 1px, transparent 2px);
      background-size: 420px 420px, 520px 520px, 460px 460px, 680px 680px, 560px 560px;
      filter: blur(.2px);
      animation: drift 18s linear infinite;
    }
    @keyframes drift{
      0%{ transform: translate3d(0,0,0); }
      50%{ transform: translate3d(-14px, 10px,0); }
      100%{ transform: translate3d(0,0,0); }
    }

    .shell{
      position: relative;
      z-index: 1; /* above sparkles */
      width: 100%;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 14px;
      padding: 0 6px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(234,223,242,.85);
      box-shadow: 0 10px 25px rgba(34, 16, 45, .06);
      font-size: 12.5px;
      color: var(--muted);
      backdrop-filter: blur(10px);
      user-select:none;
    }

    .dot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(135deg, var(--pink), var(--lav));
      box-shadow: 0 0 0 3px rgba(255,182,217,.18);
    }

    .progressWrap{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 240px;
      justify-content:flex-end;
    }

    .progressText{
      font-size: 12.5px;
      color: var(--muted);
      white-space: nowrap;
    }

    .progressBar{
      width: min(320px, 52vw);
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(234,223,242,.85);
      overflow:hidden;
      box-shadow: 0 10px 25px rgba(34, 16, 45, .06);
      backdrop-filter: blur(10px);
    }

    .progressFill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,182,217,.95), rgba(203,183,255,.95), rgba(191,230,255,.95));
      transition: width 550ms var(--ease);
    }

    .card{
      width: min(900px, 100%);
      margin: 0 auto;
      background: var(--card);
      border: 1px solid rgba(234,223,242,.95);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }

    /* IMPORTANT: no forced height – card wraps content */
    .cardInner{
      padding: 26px 22px;
      display:flex;
      justify-content:center;
    }

    .stage{
      width: min(780px, 100%);
      position: relative;
    }

    .title{
      font-family: Sora, ui-sans-serif, system-ui, sans-serif;
      font-weight: 800;
      letter-spacing: .2px;
      font-size: clamp(22px, 3.0vw, 40px);
      margin: 4px 0 10px;
      text-align:center;
    }

    /* cute but not spammy */
    .titleDecor{
      display:inline-flex;
      align-items:center;
      gap:10px;
      justify-content:center;
    }
    .miniMark{
      font-weight: 700;
      font-size: 18px;
      opacity:.9;
      background: linear-gradient(90deg, rgba(255,182,217,.95), rgba(203,183,255,.95), rgba(191,230,255,.95));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: .6px;
      user-select:none;
    }

    .subtitle{
      color: var(--muted);
      margin: 0 0 16px;
      font-size: clamp(13.5px, 1.55vw, 16px);
      line-height: 1.45;
      text-align:center;
    }

    .hr{
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(234,223,242,.95), transparent);
      margin: 18px 0;
    }

    .stakes{
      display:grid;
      gap: 10px;
      margin-top: 12px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 780px){
      .stakes{
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
    }

    .stakeRow{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(234,223,242,.9);
      box-shadow: var(--shadow-soft);
    }
    .stakeRow strong{
      color: #2f2436;
      font-weight: 800;
      letter-spacing:.1px;
    }
    .stakeRow span{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.3;
      text-align:right;
    }

    .warn{
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255,182,217,.10);
      border: 1px solid rgba(255,182,217,.32);
      color: #4e2a3e;
      font-size: 14px;
      line-height: 1.35;
      text-align:center;
    }

    .actions{
      display:flex;
      gap: 12px;
      margin-top: 18px;
      flex-wrap: wrap;
      justify-content:center;
    }

    .btn{
      appearance:none;
      border:0;
      cursor:pointer;
      border-radius: 999px;
      padding: 12px 16px;
      font-weight: 800;
      letter-spacing: .15px;
      background: linear-gradient(135deg, rgba(255,182,217,.95), rgba(203,183,255,.95));
      color: #241b2a;
      box-shadow: 0 14px 30px rgba(255,182,217,.20);
      transition: transform 180ms var(--ease), box-shadow 180ms var(--ease), filter 180ms var(--ease);
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.02); box-shadow: 0 18px 40px rgba(255,182,217,.26); }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btn.secondary{
      background: rgba(255,255,255,.68);
      border: 1px solid rgba(234,223,242,.95);
      color: var(--ink);
      box-shadow: 0 10px 25px rgba(34, 16, 45, .06);
      font-weight: 800;
    }

    .btn:disabled{
      opacity: .55;
      cursor:not-allowed;
      transform:none !important;
      filter:none !important;
    }

    .quizHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .levelTag{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(234,223,242,.95);
      color: var(--muted);
      font-size: 12.5px;
      white-space: nowrap;
      box-shadow: 0 10px 25px rgba(34, 16, 45, .06);
      margin: 0 auto;
    }
    .levelChip{
      width: 10px;height:10px;border-radius:50%;
      background: linear-gradient(135deg, var(--blue), var(--lav));
    }

    .questionText{
      font-family: Sora, ui-sans-serif, system-ui, sans-serif;
      font-weight: 800;
      margin: 10px 0 8px;
      font-size: clamp(18px, 2.4vw, 30px);
      letter-spacing: .1px;
      text-align:center;
    }

    .hint{
      color: var(--muted);
      margin: 0 0 14px;
      line-height: 1.45;
      font-size: 14.5px;
      text-align:center;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(234,223,242,.95);
      box-shadow: 0 10px 25px rgba(34, 16, 45, .06);
      color: var(--muted);
      font-size: 13px;
      margin: 0 auto;
    }

    .options{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 14px 0 8px;
    }
    @media (min-width: 740px){
      .options.twoCol{ grid-template-columns: 1fr 1fr; }
    }

    .opt{
      position: relative;
      text-align:left;
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(234,223,242,.95);
      box-shadow: 0 10px 25px rgba(34, 16, 45, .05);
      cursor:pointer;
      transition: transform 200ms var(--ease), box-shadow 200ms var(--ease), border-color 200ms var(--ease);
      overflow:hidden;
      display:flex;
      gap: 12px;
      align-items:center;
    }
    .opt:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 35px rgba(34,16,45,.08);
      border-color: rgba(203,183,255,.85);
    }
    .opt:active{ transform: translateY(1px); }

    .radio{
      width: 18px;height:18px;border-radius: 999px;
      border: 2px solid rgba(106,90,115,.35);
      background: rgba(255,255,255,.7);
      flex: 0 0 auto;
      display:grid;
      place-items:center;
      transition: border-color 200ms var(--ease), transform 200ms var(--ease);
    }
    .radio::after{
      content:"";
      width: 9px;height:9px;border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,182,217,.98), rgba(203,183,255,.98));
      transform: scale(0);
      transition: transform 180ms var(--ease);
    }

    .labelText{
      font-weight: 800;
      letter-spacing: .12px;
      color: #2c2133;
      line-height: 1.25;
      flex:1;
    }

    .opt.selected{
      border-color: rgba(255,182,217,.9);
      box-shadow: 0 16px 42px rgba(255,182,217,.14);
    }
    .opt.selected .radio{
      border-color: rgba(255,182,217,.9);
      transform: scale(1.03);
    }
    .opt.selected .radio::after{ transform: scale(1); }

    /* Reveal colors */
    .opt.reveal-correct{
      border-color: rgba(59,178,115,.55);
      background: rgba(59,178,115,.12);
      box-shadow: 0 16px 44px rgba(59,178,115,.12);
    }
    .opt.reveal-wrong{
      border-color: rgba(224,88,106,.55);
      background: rgba(224,88,106,.11);
      box-shadow: 0 16px 44px rgba(224,88,106,.10);
    }
    .opt.reveal-right-answer{
      border-color: rgba(191,230,255,.95);
      background: rgba(191,230,255,.18);
      box-shadow: 0 16px 44px rgba(191,230,255,.10);
    }

    .bouquetThumb{
      width: 96px;
      height: 70px;
      border-radius: 14px;
      flex: 0 0 auto;
      background:
        radial-gradient(120px 80px at 20% 20%, rgba(255,182,217,.35), transparent 60%),
        radial-gradient(120px 80px at 80% 30%, rgba(203,183,255,.35), transparent 60%),
        radial-gradient(120px 80px at 40% 80%, rgba(191,230,255,.30), transparent 60%),
        rgba(255,255,255,.55);
      border: 1px solid rgba(234,223,242,.95);
      box-shadow: 0 10px 25px rgba(34, 16, 45, .06);
      background-size: cover;
      background-position: center;
    }

    .feedback{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(234,223,242,.95);
      color: #2f2436;
      box-shadow: 0 10px 25px rgba(34, 16, 45, .05);
      line-height: 1.45;
      display:none;
      text-align:center;
    }
    .feedback.show{ display:block; animation: pop 320ms var(--ease) both; }
    @keyframes pop{
      from{ transform: translateY(6px); opacity: 0; }
      to{ transform: translateY(0); opacity: 1; }
    }

    .footerRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    /* FIX: hidden screens must not take space */
    .screen{ display:none; }
    .screen.active{
      display:block;
      animation: enter 420ms var(--ease) both;
    }
    @keyframes enter{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .resultHero{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .scoreBig{
      font-family: Sora, ui-sans-serif, system-ui, sans-serif;
      font-weight: 900;
      font-size: clamp(40px, 6.0vw, 68px);
      line-height: 1;
      margin: 6px 0 6px;
      letter-spacing: .1px;
    }

    .confetti{
      position: absolute;
      inset: -40px -20px auto -20px;
      height: 0;
      pointer-events:none;
    }
    .confetti i{
      position:absolute;
      width: 10px;
      height: 10px;
      border-radius: 4px;
      opacity: .0;
      transform: translateY(-12px) rotate(0deg);
      animation: conf 900ms var(--ease) forwards;
    }
    @keyframes conf{
      0%{ opacity: 0; transform: translateY(-12px) rotate(0deg) scale(.8); }
      15%{ opacity: .9; }
      100%{ opacity: 0; transform: translateY(120px) rotate(200deg) scale(1.05); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="panel">
      <div class="shell">
        <div class="topbar">
          <div class="badge"><span class="dot"></span><span>Premium Wissal Access</span></div>

          <div class="progressWrap" aria-live="polite">
            <div class="progressText" id="progressText">Title</div>
            <div class="progressBar" aria-hidden="true">
              <div class="progressFill" id="progressFill"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardInner">
            <div class="stage">

              <!-- TITLE SCREEN -->
              <section class="screen active" id="screenTitle">
                <div class="title">
                  <span class="titleDecor">
                    <span class="miniMark">♡</span>
                    <span>THE OFFICIAL WISSAL KNOWLEDGE EXAM</span>
                    <span class="miniMark">✦</span>
                  </span>
                </div>
                <p class="subtitle">Prove you deserve Premium Wissal Access</p>

                <div class="hr"></div>

                <p class="subtitle" style="margin-bottom:10px;">
                  Your final score determines your reward.
                </p>

                <div class="stakes" role="list" aria-label="Reward tiers">
                  <div class="stakeRow" role="listitem"><strong>0–40%</strong><span>You tried. Reward: 1 hug</span></div>
                  <div class="stakeRow" role="listitem"><strong>50%</strong><span>Reward: 10-minute massage</span></div>
                  <div class="stakeRow" role="listitem"><strong>60%</strong><span>Reward: 15-minute massage + Mamissal pass for a day </span></div>
                  <div class="stakeRow" role="listitem"><strong>70%</strong><span>Reward: 20-minute massage + 2 TFT game coupons</span></div>
                  <div class="stakeRow" role="listitem"><strong>80%</strong><span>Reward: 2 LoL games where she actually tries</span></div>
                  <div class="stakeRow" role="listitem"><strong>90%</strong><span>Legendary Boyfriend Status. Reward: Ice skating whenever you want</span></div>
                  <div class="stakeRow" role="listitem" style="grid-column: 1 / -1;">
                    <strong>100%</strong>
                    <span>Wissal’s Favorite Human. Reward: 5 LoL coupons + 5 TFT coupons (each coupon = 5 games)</span>
                  </div>
                </div>

                <div class="warn">Final question has emotional consequences. Penalty applies if wrong. ♡</div>

                <div class="actions">
                  <button class="btn" id="btnBegin">Begin Exam</button>
                  <button class="btn secondary" id="btnPreview">Preview Questions</button>
                </div>
              </section>

              <!-- QUIZ SCREEN -->
              <section class="screen" id="screenQuiz" aria-live="polite" style="position:relative;">
                <div class="confetti" id="confetti" aria-hidden="true"></div>

                <div class="quizHead">
                  <div style="width:100%;">
                    <div style="display:flex; justify-content:center; margin-bottom:10px;">
                      <div class="levelTag" id="levelTag">
                        <span class="levelChip"></span>
                        <span id="levelText">LEVEL</span>
                      </div>
                    </div>

                    <div class="questionText" id="questionText">Question</div>
                    <p class="hint" id="questionHint"></p>

                    <div style="display:flex; justify-content:center;">
                      <div class="pill" id="metaPill"><span id="tinyMeta">Each question has equal weight.</span></div>
                    </div>
                  </div>
                </div>

                <div id="optionsWrap"></div>

                <div class="feedback" id="feedbackBox"></div>

                <div class="footerRow">
                  <button class="btn secondary" id="btnBack" type="button">Back</button>
                  <button class="btn" id="btnPrimary" type="button" disabled>Reveal answer</button>
                </div>
              </section>

              <!-- RESULT SCREEN -->
              <section class="screen" id="screenResult">
                <div class="title">
                  <span class="titleDecor">
                    <span class="miniMark">✦</span>
                    <span>Results</span>
                    <span class="miniMark">♡</span>
                  </span>
                </div>
                <p class="subtitle">Final score, title, and reward are below.</p>

                <div class="hr"></div>

                <div class="resultHero">
                  <div>
                    <div class="scoreBig" id="finalScore">0%</div>
                    <div class="stakeRow" style="margin-top:10px;">
                      <strong>Title</strong>
                      <span id="finalTitle">—</span>
                    </div>
                  </div>
                  <div style="min-width:min(420px,100%);">
                    <div class="stakeRow" style="margin-bottom:10px;">
                      <strong>Reward</strong>
                      <span id="finalReward">—</span>
                    </div>
                    <div class="stakeRow">
                      <strong>Message</strong>
                      <span id="finalMessage">—</span>
                    </div>
                  </div>
                </div>

                <div class="warn" style="margin-top: 16px;">
                  You have successfully unlocked: Wissal
                  <div style="opacity:.9; margin-top:6px;">No matter the score, you’re still my favorite.</div>
                </div>

                <div class="actions">
                  <button class="btn" id="btnRestart">Retake Exam</button>
                  <button class="btn secondary" id="btnCopy">Copy Result Text</button>
                </div>
              </section>

              <!-- PREVIEW -->
              <section class="screen" id="screenPreview">
                <div class="title">
                  <span class="titleDecor">
                    <span class="miniMark">♡</span>
                    <span>Question Preview</span>
                    <span class="miniMark">✦</span>
                  </span>
                </div>
                <p class="subtitle">A quick look at the exam structure.</p>

                <div class="hr"></div>

                <div id="previewList" class="stakes"></div>

                <div class="actions">
                  <button class="btn" id="btnStartFromPreview">Start Exam</button>
                  <button class="btn secondary" id="btnClosePreview">Back</button>
                </div>
              </section>

            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // Bouquet image mapping (same folder as index.html)
    const bouquetImages = {
      "Bouquet A": "%23Festive25%20bouquet.jpg",
      "Bouquet B": "Wedding%20accessory%20idea.jpg",
      "Bouquet C": "download%20(1).jpg",
      "Bouquet D": "download.jpg"
    };

    // Q12 removed. Hard = Q9–Q11. Q11 is final with -20% if wrong.
    const questions = [
      { id: 1, level: "LEVEL 1 — EASY", prompt: "What is Wissal’s favorite animated show?", options: ["SpongeBob","Adventure Time","Both equally"], correct: "Both equally",
        feedback:{ correct:"Correct, She loves them both equally.", wrong:"Wrong. You need to pay more attention." } },
      { id: 2, level: "LEVEL 1 — EASY", prompt: "What is Wissal’s favorite sitcom?", options: ["Friends","Brooklyn 99","Both equally"], correct: "Both equally",
        feedback:{ correct:"Correct, they're both amazing in their own way", wrong:"Wrong. This is suspicious." } },
      { id: 3, level: "LEVEL 1 — EASY", prompt: "What is Wissal’s favorite color?", options: ["Pink","Baby blue","Purple"], correct: "Purple",
        feedback:{ correct:"Correct, basic question good job.", wrong:"Wrong, you should be ashamed. Try again in another life." } },
      { id: 4, level: "LEVEL 1 — EASY", prompt: "Wissal’s dream date energy?", options: ["Planned and aesthetic","Cozy and chill","Chaotic but memorable"], correct: "Cozy and chill",
        feedback:{ correct:"Correct, although every date with you is a perfect date <3 (romance).", wrong:"Wrong. nice try." } },

      { id: 5, level: "LEVEL 2 — MEDIUM", prompt: "How many times has Wissal rewatched Friends?", options: ["3","5","More than 5","She doesn’t remember"], correct: "She doesn’t remember",
        feedback:{ correct:"Correct. Too many times to count", wrong:"Wrong. She genuinely doesn’t remember." } },
      { id: 6, level: "LEVEL 2 — MEDIUM", prompt: "Which bouquet would Wissal choose?", options: ["Bouquet A","Bouquet B","Bouquet C","Bouquet D"], correct: "Bouquet C",
        bouquet:true, feedback:{ correct:"Correct choice, although i love them all either way.", wrong:"Wrong. Look again." } },
      { id: 7, level: "LEVEL 2 — MEDIUM", prompt: "Which plushie is Wissal’s favorite?", options: ["Roberto","Bob","Hello Kitty","H Bear"], correct: "Bob",
        feedback:{ correct:"Correct, Bob is my son.", wrong:"Wrong. It’s Bob. Family always comes first." } },
      { id: 8, level: "LEVEL 2 — MEDIUM", prompt: "Wissal’s dream travel destination is:", options: ["Japan","Portugal","Roma"], correct: "Portugal",
        feedback:{ correct:"Correct, Inshaallah we can visit together !", wrong:"Wrong. Try Portugal." } },

      { id: 9, level: "LEVEL 3 — HARD", prompt: "Is Wissal low-maintenance, high-maintenance, or none of the above?",
        options: ["Low-maintenance","High-maintenance","None of the above"], correct: "None of the above",
        feedback:{ correct:"That’s right. Wissal is not high-maintenance. Being Wissal is high-maintenance", wrong:"Wrong. It’s high-maintenance to BE Wissal." } },
      { id:10, level: "LEVEL 3 — HARD", prompt: "What is Wissal’s favorite sweet treat?",
        options: ["Brownie","Cookie","Red velvet","None of the above"], correct: "None of the above",
        feedback:{ correct:"Good job! You’re my favorite sweet treat, silly.", wrong:"Trick question. You’re my favorite sweet treat, silly.. The correct answer is none of the above, you are my sweet treat." } },
      { id:11, level: "LEVEL 3 — HARD (FINAL)", prompt: "Who is Wissal’s favorite tebozi?",
        options: ["The Boz","Slilih","Gloomy","Bob","Papitam"], correct: "Papitam", penaltyWrong:true,
        feedback:{ correct:"Of course its you zayn. You survived.", wrong:"Incorrect. That one hurt. Penalty applied." } }
    ];

    const state = {
      started: false,
      idx: 0,
      answers: new Array(questions.length).fill(null),
      revealed: new Array(questions.length).fill(false)
    };

    const el = {
      screenTitle: document.getElementById("screenTitle"),
      screenQuiz: document.getElementById("screenQuiz"),
      screenResult: document.getElementById("screenResult"),
      screenPreview: document.getElementById("screenPreview"),

      btnBegin: document.getElementById("btnBegin"),
      btnPreview: document.getElementById("btnPreview"),
      btnClosePreview: document.getElementById("btnClosePreview"),
      btnStartFromPreview: document.getElementById("btnStartFromPreview"),

      questionText: document.getElementById("questionText"),
      questionHint: document.getElementById("questionHint"),
      optionsWrap: document.getElementById("optionsWrap"),
      feedbackBox: document.getElementById("feedbackBox"),

      btnPrimary: document.getElementById("btnPrimary"),
      btnBack: document.getElementById("btnBack"),

      progressText: document.getElementById("progressText"),
      progressFill: document.getElementById("progressFill"),

      levelText: document.getElementById("levelText"),
      levelTag: document.getElementById("levelTag"),
      tinyMeta: document.getElementById("tinyMeta"),

      finalScore: document.getElementById("finalScore"),
      finalTitle: document.getElementById("finalTitle"),
      finalReward: document.getElementById("finalReward"),
      finalMessage: document.getElementById("finalMessage"),
      btnRestart: document.getElementById("btnRestart"),
      btnCopy: document.getElementById("btnCopy"),

      confetti: document.getElementById("confetti"),
      previewList: document.getElementById("previewList")
    };

    function showScreen(target){
      [el.screenTitle, el.screenQuiz, el.screenResult, el.screenPreview].forEach(s => s.classList.remove("active"));
      target.classList.add("active");
    }

    function setProgress(){
      if(!state.started){
        el.progressText.textContent = "Title";
        el.progressFill.style.width = "0%";
        return;
      }
      const qNum = state.idx + 1;
      const total = questions.length;
      el.progressText.textContent = `Question ${qNum} of ${total}`;
      el.progressFill.style.width = `${Math.round((qNum-1)/total*100)}%`;
    }

    function levelColor(level){
      if(level.includes("EASY")) return "linear-gradient(135deg, rgba(191,230,255,.95), rgba(203,183,255,.95))";
      if(level.includes("MEDIUM")) return "linear-gradient(135deg, rgba(255,182,217,.95), rgba(191,230,255,.95))";
      return "linear-gradient(135deg, rgba(255,182,217,.95), rgba(203,183,255,.95))";
    }

    function renderQuestion(){
      const q = questions[state.idx];
      setProgress();

      el.levelText.textContent = q.level;
      el.levelTag.querySelector(".levelChip").style.background = levelColor(q.level);

      el.questionText.textContent = q.prompt;

      let hint = "";
      if(q.level.includes("EASY")) hint = "You should know this.";
      if(q.level.includes("MEDIUM")) hint = "Now you actually have to pay attention.";
      if(q.level.includes("HARD") && !q.level.includes("FINAL")) hint = "Think before you click.";
      if(q.level.includes("FINAL")) hint = "Emotional consequences enabled.";
      el.questionHint.textContent = hint;

      el.tinyMeta.textContent = q.penaltyWrong ? "Equal weight. This one applies a penalty if wrong." : "Each question has equal weight.";

      el.feedbackBox.classList.remove("show");
      el.feedbackBox.textContent = "";

      el.optionsWrap.innerHTML = "";

      const wrap = document.createElement("div");
      wrap.className = "options" + (q.options.length === 4 ? " twoCol" : "");

      q.options.forEach(opt => wrap.appendChild(makeOptionButton(q, opt)));
      el.optionsWrap.appendChild(wrap);

      // restore selected
      const chosen = state.answers[state.idx];
      if(chosen){
        [...el.optionsWrap.querySelectorAll(".opt")].forEach(b => {
          if(b.dataset.value === chosen) b.classList.add("selected");
        });
      }

      el.btnBack.disabled = state.idx === 0;

      if(state.revealed[state.idx]){
        applyRevealState();
        el.btnPrimary.disabled = false;
        el.btnPrimary.textContent = (state.idx === questions.length - 1) ? "See results" : "Next question";
      } else {
        el.btnPrimary.textContent = "Reveal answer";
        el.btnPrimary.disabled = !state.answers[state.idx];
      }
    }

    function makeOptionButton(q, opt){
      const btn = document.createElement("button");
      btn.className = "opt";
      btn.type = "button";
      btn.dataset.value = opt;

      const radio = document.createElement("span");
      radio.className = "radio";
      radio.setAttribute("aria-hidden", "true");

      let thumb = null;
      if(q.bouquet){
        thumb = document.createElement("div");
        thumb.className = "bouquetThumb";
        const imgUrl = bouquetImages[opt];
        if(imgUrl) thumb.style.backgroundImage = `url('${imgUrl}')`;
      }

      const label = document.createElement("span");
      label.className = "labelText";
      label.textContent = opt;

      btn.appendChild(radio);
      if(thumb) btn.appendChild(thumb);
      btn.appendChild(label);

      btn.addEventListener("click", () => {
        if(state.revealed[state.idx]) return;

        state.answers[state.idx] = opt;

        [...el.optionsWrap.querySelectorAll(".opt")].forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");

        el.btnPrimary.disabled = false;
        el.feedbackBox.classList.remove("show");
        el.feedbackBox.textContent = "";
      });

      return btn;
    }

    function isCorrect(q, answer){ return answer === q.correct; }

    function applyRevealState(){
      const q = questions[state.idx];
      const ans = state.answers[state.idx];
      if(!ans) return;

      const correct = isCorrect(q, ans);

      [...el.optionsWrap.querySelectorAll(".opt")].forEach(b => {
        b.classList.remove("reveal-correct","reveal-wrong","reveal-right-answer");
      });

      [...el.optionsWrap.querySelectorAll(".opt")].forEach(b => {
        const val = b.dataset.value;
        b.style.pointerEvents = "none";
        b.style.cursor = "default";

        if(val === ans){
          b.classList.add(correct ? "reveal-correct" : "reveal-wrong");
        }
        if(!correct && val === q.correct){
          b.classList.add("reveal-right-answer");
        }
      });

      const fb = q.feedback || {};
      const msg = correct ? (fb.correct || "Correct.") : (fb.wrong || "Wrong.");

      el.feedbackBox.textContent = msg;
      el.feedbackBox.classList.add("show");
    }

    function revealCurrent(){
      const q = questions[state.idx];
      const ans = state.answers[state.idx];
      if(!ans) return;

      state.revealed[state.idx] = true;
      applyRevealState();

      el.btnPrimary.textContent = (state.idx === questions.length - 1) ? "See results" : "Next question";
      el.btnPrimary.disabled = false;
    }

    function scoreQuiz(){
      const total = questions.length;
      let correctCount = 0;

      questions.forEach((q, i) => {
        if(isCorrect(q, state.answers[i])) correctCount++;
      });

      let percent = (correctCount / total) * 100;

      const finalIdx = questions.findIndex(q => q.id === 11);
      const finalQ = questions[finalIdx];
      const finalAns = state.answers[finalIdx];
      const finalWrong = finalQ.penaltyWrong && finalAns && !isCorrect(finalQ, finalAns);

      if(finalWrong) percent -= 20;

      percent = Math.max(0, Math.min(100, percent));
      return { display: Math.round(percent), correctCount, finalWrong };
    }

    function rewardTier(score){
      if(score === 100) return { title:"Wissal’s Favorite Papitam", reward:"5 LoL coupons + 5 TFT coupons (each coupon = 5 games)", message:"Perfect Papitam, but don't forget : potit potit." };
      if(score >= 90) return { title:"Pro Papitam", reward:"Ice skating whenever you want", message:"Well done solid effort." };
      if(score >= 80) return { title:"Wissal Will Actually Try", reward:"2 LoL games where I actually try", message:"You earned focus mode." };
      if(score >= 70) return { title:"TFT Coupons", reward:"20-minute massage + 2 TFT game coupons", message:"Good job, next time's the charm. " };
      if(score >= 60) return { title:"mamissal pass Approved", reward:"15-minute massage + mamissal pass for a day", message:"Okay, You'll do better next time." };
      if(score >= 50) return { title:"Effort Recognized", reward:"10-minute massage", message:"#Sad, take more notes next time." };
      return { title:"You tried", reward:"1 hug", message:"On Casse" };
    }

    function goNextOrFinish(){
      if(!state.revealed[state.idx]){
        revealCurrent();
        return;
      }
      if(state.idx === questions.length - 1){
        showResults();
        return;
      }
      state.idx++;
      renderQuestion();
    }

    function goBack(){
      if(state.idx === 0) return;
      state.idx--;
      renderQuestion();
    }

    function burstConfetti(){
      el.confetti.innerHTML = "";
      const colors = [
        "rgba(255,182,217,.95)",
        "rgba(203,183,255,.95)",
        "rgba(191,230,255,.95)",
        "rgba(255,255,255,.95)"
      ];
      const count = 18;

      for(let i=0;i<count;i++){
        const piece = document.createElement("i");
        const left = Math.random()*100;
        const delay = Math.random()*120;
        const size = 8 + Math.random()*8;
        piece.style.left = left + "%";
        piece.style.top = (6 + Math.random()*10) + "px";
        piece.style.width = size + "px";
        piece.style.height = size + "px";
        piece.style.background = colors[Math.floor(Math.random()*colors.length)];
        piece.style.animationDelay = delay + "ms";
        piece.style.transform = `translateY(-12px) rotate(${Math.random()*90}deg)`;
        el.confetti.appendChild(piece);
      }
    }

    function showResults(){
      const { display, correctCount, finalWrong } = scoreQuiz();
      const tier = rewardTier(display);

      el.finalScore.textContent = `${display}%`;
      el.finalTitle.textContent = tier.title;
      el.finalReward.textContent = tier.reward;

      let msg = tier.message;
      if(finalWrong) msg = "Final answer was incorrect. Penalty applied.";
      el.finalMessage.textContent = msg;

      el.progressText.textContent = `Complete (${correctCount}/${questions.length})`;
      el.progressFill.style.width = "100%";

      showScreen(el.screenResult);
      burstConfetti();
    }

    function reset(){
      state.started = true;
      state.idx = 0;
      state.answers = new Array(questions.length).fill(null);
      state.revealed = new Array(questions.length).fill(false);

      showScreen(el.screenQuiz);
      renderQuestion();
    }

    function renderPreview(){
      el.previewList.innerHTML = "";
      questions.forEach((q) => {
        const item = document.createElement("div");
        item.className = "stakeRow";
        item.innerHTML = `<strong>${escapeHtml(q.level)}</strong><span>${escapeHtml(q.prompt)}</span>`;
        el.previewList.appendChild(item);
      });
    }

    async function copyResult(){
      const { display, correctCount, finalWrong } = scoreQuiz();
      const tier = rewardTier(display);
      const extra = finalWrong ? "\nPenalty applied on final question." : "";
      const txt =
`WISSAL KNOWLEDGE EXAM RESULTS
Score: ${display}% (${correctCount}/${questions.length} correct)${extra}
Title: ${tier.title}
Reward: ${tier.reward}
Message: ${el.finalMessage.textContent}

Unlocked: Wissal
No matter the score, you’re still my favorite papitam ever.`;

      try{
        await navigator.clipboard.writeText(txt);
        el.btnCopy.textContent = "Copied";
        setTimeout(() => el.btnCopy.textContent = "Copy Result Text", 1200);
      }catch(e){
        alert("Copy failed. You can select and copy manually.");
      }
    }

    el.btnBegin.addEventListener("click", reset);

    el.btnPreview.addEventListener("click", () => {
      renderPreview();
      showScreen(el.screenPreview);
      el.progressText.textContent = "Preview";
      el.progressFill.style.width = "0%";
    });

    el.btnClosePreview.addEventListener("click", () => {
      showScreen(el.screenTitle);
      state.started = false;
      setProgress();
    });

    el.btnStartFromPreview.addEventListener("click", reset);

    el.btnPrimary.addEventListener("click", goNextOrFinish);
    el.btnBack.addEventListener("click", goBack);

    el.btnRestart.addEventListener("click", reset);
    el.btnCopy.addEventListener("click", copyResult);

    window.addEventListener("keydown", (e) => {
      if(!el.screenQuiz.classList.contains("active")) return;

      const q = questions[state.idx];

      if(!state.revealed[state.idx]){
        const map = { "1":0, "2":1, "3":2, "4":3 };
        if(map[e.key] !== undefined && q.options[map[e.key]]){
          const optVal = q.options[map[e.key]];
          const btn = [...el.optionsWrap.querySelectorAll(".opt")].find(b => b.dataset.value === optVal);
          if(btn) btn.click();
        }
      }

      if(e.key === "Enter" && !el.btnPrimary.disabled) el.btnPrimary.click();
      if(e.key === "Backspace") el.btnBack.click();
    });

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    setProgress();
  </script>
</body>
</html>
